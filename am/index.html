<!doctype html>
<!--[if lt IE 7]>     <html class="lt-ie9 lt-ie8 lt-ie7" lang="ru"><![endif]-->
<!--[if IE 7]>        <html class="lt-ie9 lt-ie8"        lang="ru"><![endif]-->
<!--[if IE 8]>        <html class="lt-ie9"               lang="ru"><![endif]-->
<!--[if gt IE 8]><!--><html lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="am.css">
</head>

<body>
    
    <div class="wrapper clearfix">
        <div class="ulist-box"></div>

        <div class="jform">
            <div class="jform-field-box clearfix">
                <input type="text" class="jform-field" placeholder="Поиск">
                <span class="jform-btn">Найти</span>
            </div>
            <p class="jform-title">Искать только в категориях:</p>
            <div class="jform-inner clearfix"></div>
        </div>

    </div>

    <script type="text/javascript">
        UlistData = [{
            title: '3D-шутеры, «бродилки-стрелялки»',
            childs: [{
                title: 'Шутеры от первого и от третьего лица' }, {
                title: '«Кровавые» шутеры' }, {
                title: 'Тактические шутеры', active: true 
            }]
        }, {
            title: 'Файтинги',
            childs: [{
                title: 'Избей их всех', active: true }, {
                title: 'Слэшер', active: true 
            }]
        }, {
            title: 'Симуляторы/Менеджеры',
            childs: [{
                title: 'Технические' }, {
                title: 'Аркадные' }, {
                title: 'Спортивные', active: true }, {
                title: 'Спортивный менеджер', active: true }, {
                title: 'Экономические'
            }]
        }, {
            title: 'Стратегии по схеме игрового процесса',
            childs: [{
                title: 'Стратегии в реальном времени' }, {
                title: 'Пошаговые стратегии' }, {
                title: 'Карточные стратегии'
            }]
        }, {
            title: 'Стратегии по масштабу игрового процесса',
            childs: [{
                title: 'Варгеймы' }, {
                title: 'Глобальные стратегии' }, {
                title: 'Симуляторы бога' }, {
                title: 'Спортивный менеджер' }, {
                title: 'Экономические'
            }]
        }];
    </script>

    <script id="ulist-tmpl-border-radius" type="text/x-jquery-tmpl">
        <div class="ulist">
            <div class="ulist-title">
                <i class="ulist-icon-arrow"></i>
                <span>${title}</span>
                <i class="ulist-icon-control"></i>
            </div>
            <ul class="ulist-list">
                {{each childs}}
                {{if $index < childs.length - 1}}
                <li class="ulist-item ${$item.getActiveCls($index)}"><i></i>${title}</li>
                {{else}}
                <li class="ulist-item ${$item.getActiveCls($index)} ulist-item-last"><i></i>${title}</li>
                {{/if}}
                {{/each}}
            </ul>
        </div>
    </script>

    <script id="ulist-tmpl-no-border-radius" type="text/x-jquery-tmpl">
        <div class="ulist">
            <div class="ulist-title clearfix">
                <i class="ulist-corner-left"></i>
                <i class="ulist-corner-right"></i>
                <div class="ulist-title-inner">
                    <i class="ulist-icon-arrow"></i>
                    <span>${title}</span>
                    <i class="ulist-icon-control"></i>
                </div>
            </div>
            <ul class="ulist-list">
                {{each childs}}
                {{if $index < childs.length - 1}}
                <li class="ulist-item ${$item.getActiveCls($index)}"><i></i>${title}</li>
                {{else}}
                <li class="ulist-item ${$item.getActiveCls($index)} ulist-item-last">
                    <span class="ulist-corner-left"></span>
                    <div class="ulist-item-inner">
                        <i class="ulist-item-state"></i>Тактические шутеры
                    </div>
                    <span class="ulist-corner-right"></span>
                </li>
                {{/if}}
                {{/each}}
            </ul>
        </div>
    </script>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="jquery.tmpl.js"></script>
    <script src="placeholder.js"></script>
    <script src="am.js"></script>
    <script>
        $( document ).ready( function() {
            var ulist, ulistApi, field, fieldApi, ulistProps, findBtn, tmplFuncs;

            ulistProps = {
                fixBoxWidth: true,
                fixBoxItemsWidth: true,
                selectBox: $( '.jform-inner' )
            };

            tmplFuncs = {
                getActiveCls: function ( index ) {
                    return this.data.childs[ index ].active ? 'ulist-item-active' : '';
                }
            };

            if ( UlistData ) {
                $.support.borderRadius ?
                    $( '#ulist-tmpl-border-radius' ).tmpl( UlistData, tmplFuncs ).appendTo( '.ulist-box' ) :
                    $( '#ulist-tmpl-no-border-radius' ).tmpl( UlistData, tmplFuncs ).appendTo( '.ulist-box' );
            }

            ulist    = $( '.ulist-box' ).Ulist( ulistProps );
            field    = $( '.jform-field' ).iHolder();
            findBtn  = $( '.jform-btn');
            ulistApi = ulist.data( 'ulist' );
            fieldApi = field.data( 'iHolder' );

            field.keyup( onFieldKeyup );
            findBtn.click( onFindBtnClick );
            !$.support.borderRadius ? $( '.ulist-corner-right' ).show() : null;

            fieldApi.test() ?
                $( 'body' ).addClass( 'css3-placeholder' ) :
                $( 'body' ).addClass( 'css3-no-placeholder' );

            function onFindBtnClick() {
                trySend();
            }

            function onFieldKeyup( e ) {
                if ( e.keyCode === 13 ) {
                    trySend();
                }   
            }

            function trySend() {
                var params = ulistApi.getParams(),
                    value = $.trim( field.val() );

                if ( value && value !== fieldApi.placeholder ) {
                    sendXhr( value, params );
                }    
            }

            function sendXhr( value, params ) {
                console.log( value, params );
            }
        });        
    </script>

</body>

</html>